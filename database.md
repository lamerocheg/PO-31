# Базы данных

-----

## Назначение СУБД(Систем управления базами данных)

Основная идея это хранение на внешнем носителе не только самих данных , но и описание их структур.

![alt text](http://i.imgur.com/lnG78pB.png "классическое взаимодействие с файлами")

![alt text](http://i.imgur.com/TkRCf0J.png "взаимодействие программ с файлами при помощи субд")

#### достоинства использования СУБД :

1. снижение сетевого трафика.
2. возможность создания программ независимых от структуры хранения данных на внешнем устройстве.
3. возможность использования стандартных качественно реализованных СУБД алгоритмов обработки данных(сортировка, поиск, ведение индексов и т. д.)
4. автоматическое поддержание целостности данных. Авто резервное копирование, откат транзакций и др.
5. разграничение доступа к данным за счет авторизации пользователя и установки уровня по умолчанию
6. автоматизация отображения данных

---

## Иерархическая и сетевая модель данных

СУБД различаются способом представления связей между объектами(моделями данных) 

1. иерархическая
2. сетевая
3. реляционная
4. пост-реляционная
 
Исторически первой была система IMS  производства IBM  ее украли и назвали OKA. В ней 1 объект является главным а остальные подчиненные на разных уровнях иерархии.
недостаток : реальные объекты не всегда находятся в строгой иерархической зависимости. 
В сетевых базах любой объект может быть как главным так и подчиненным ADABAS ее украли и назвали ADABAC. Основной недостаток -  это инструмент для программистов.
В начале 70-х Кодд предложил реляционную модель СУБД.

-

## Реляционная модель СУБД.

Кодд стремился упростить структуру базы.
В традиционных реляционных СУБД данные хранятся в таблицах. Таблица соответствует типу объекта. Строка таблицы это экземпляр объекта. Столбец — значения атрибута в экземплярах. Имена таблиц уникальны в базе. Имена столбцов уникальны в таблице. Таблица может иметь произвольное количество строк. Возможно — ни одной. Строки таблицы не упорядочены. Нет понятия 1 строка или последняя. Каждая таблица содержит поле или совокупность полей однозначно определяющих запись это поле или совокупность называется первичный ключ. Поле или совокупность полей значение которых совпадают со значением первичного ключа одной из записей в другой таблице называются внешним ключом совокупность внешнего и первичного ключа определяют связь между объектами таблица с первичным ключом родительская , таблица с внешним ключом дочерняя. 

-

## Проектирование баз данных

#### этапы :

1. определение состава объектов
2. определение связи между объектами 
3. определение атибутов объектов 
4. нормализация отношений 

Предположим что база данных об учебном процессе. объекты будут `факультет` , `кафедра` , `преподаватель` , `группа` , `студент`

есть три типа связи. 
1. 1 к 1 :одному экземпляру первого типа соответствует 1 экземпляр второго типа (<--->). хотя такое возможно но встречается редко и вообще быть не должно. есть 2 причины почему одну таблицу можно разделить : производительность и упрощение администрирования. 
2. 1 к многим : 1 экземпляру объекта первого типа соответствует много экземплярова объектов второго типа (<--->->) .
3. многие ко многим : одному обекту первого тип могут соответствовать многие и наоборот. такх связей не существует . если реально такая связ есть то проблема решается добавленем еще одного типа объекта. дочернего по отношению к ним.

####Определение состава атрибутов объекта

1. поля первичного ключа
2. поля внешних ключей в дочерних таблицах
3. не ключевые атрибуты

####Нормализация отношений 

нормализация отношений это процесс выбора оптимального состава объектов. 

Пусть сведения о нагрузке представлены в таблице нагрузка преподавателя

####1НФ

Говорят что отношения находятся в первой нормальной форме если значения каждого атрибута неделимо.

Недостатки :
1. проблема реализации обновления данных(нельзя добавить преподавателя не имеющего нагрузки)
2. при удалении нагрузки теряются сведения о преподавателе
3. изменения значения атрибутов требуют просмотра всей таблицы 

####2НФ

отношения в первой нормальной форме и каждый неключевой атрибут полностью зависит от всех атрибутов первичного ключа

переход к 2НФ разделением отношения на несколько

есть недостатки :

1. нельзя добавить кафедру не указав преподавателя
2. при удалении преподавателей теряются ведения о кафедрах
3. изменение зависимости кафедра-факультет требует просмотра всего отношения 

####3НФ

Говорят что отношения в третьей нормалной форме если она во второй и каждый неключевой атрибут нетранзитивно зависит от ключа

преобразование путем разделения отношений 

достоинством нормализации является устранение избыточности данных. 

### дополниельные рекомедации по проектированию :

1. не нужно включать в базу атрибут значение которого может быть расчитано по другим атрибутам. т.к. тогда значние нового атрибута придется пересчитывать при изменении исходных данных. <триггер>
2. при наличии повторяющегося значения атрибута в таблице обычно выгодно создать дополнительную таблиу-справочник в формате код-значение. значение атрибут может мняться во времени и код решает проблему. при наличии справочника в приожениях можно выполнять не ввод значения а выбор из списка.

-

## Создание базы данных

теперь надо создать реальную базу данных. описать атблицы поля и связи. изначально в MS Acces. В любой СУБД есть визуальные средства для определения визуальной структуры базы данных. когда созаем пустую базу данных. потом можем создавать таблицы появляется форма где можно вводить имена полей и указывать их типы. 
#### Типы данных(полей)
######MS Access
* текстовое поле(250 символов/ можно указать длину)
* Memo(текстовое поле но длина до 2гб)
* числовой(в свойствах тип числа . целый - 2 байта , длинный целый 4 байта , плавающие 5 и 8 байт)
* денежный тип
* счетчик(длинное целое, значение которого автоматчески вырабатывается для каждой новой записи)
* логический
* дата\время
* #m/d/y# константа даты

######MS SQL Server
* char, varchar(эквиваленты ткстового поля до 8192 символов)
* text(устаревает) , varchar(max) 
* nchar , nvarchar , ntext - кодировка юникод
* tinyint целое 1 байт
* smallint 2 байта
* int 4 байта
* bigint 8 байтовое целое 
* money
* int + identity
* bit
* datetime

для поля счетчика должно быть индексировано и совпадения недопускаютяы
#### создание схемы данных

схемы данных испольуются при визуальном создании запросов . с помощью схемы данных указываются правила поддержания ссылочной целосности
меню - съема данных. 
правая кнопка на связи -> ссылочная целосность. в дочерню таблицу нельзя добавить запись с неверным кодом объекта раддомтельвой и нельзя удалить объект родительской если к нему привязаны объекты дочерней

##правило Кодда 

* правило информации : вся информация в базе данных представлена в виде таблиц
* правило гарантированного доступа : доступ к любому значению обеспечивается путем использования комбинации имени таблицы , значения первичного ключа и имени столбца 
* правило поддержки недействительных значений : должны поддерживаться `NULL` значения которые отличаются от пустой строки, строки пробелов, нуля и означают отстутствие значения 
* правило каталога основанного на реляционной модели : описание структуры базы данных тоже хранится в таблице 
* правило исчерпывающего подъязыка дат : должен существовать язык общения с СУБД операторы которого представимы в виде строки символов в соответсви с не которым синтаксисом. язык обеспечивает пределение структуры данных определение представлений которые являются виртуальными таблицами и позволяют показывать различным пользвателям различные фрагменты баз данных. поддерживать обработку данных. определение условий целосности данных. идентификацию прав доступа. границы транзакций.
* правило обновления представлений : все представления которые теоретически можно обновить должны быть дступны для обовления
* правило добавления обновления и удаления : возможность работы с таблицей как с единым целым должно быть не только при просмотре , но и при добавлении обновлении и удалении записи
* правило независимости физических данных : программы должны остаться нетронутыми при любых изменеиях физических способов хранения данных и методов работы с ними 
* правило независимости логических данных : прикладные программы должны отставаться нетронутыми при внесении в таблицы любых именения которые позваляют сохранить нетронутыми ранее содержащиеся в таблицах данные
* правило независимости условий целосности : дожна уществовать воможность определить условие целоности пеифические для конкретной базы даных а не хранть их в базе данных а не в прикладной программе 
* правило независимости распространения : реляционная СУБД не должна завсеть от птребностей конкртного клиента 
* првио единственности : если в реляционой системе есь низкоуровневый язык то не должно быть возмоостей оботи с помощиью этого языка учловия целосности данных

## операции реляционой алгебры 
операции реляционной алгебры это операции над таблицами результатом которых тоже являются таблицы . есть 5 основных и 4 вспомогательных. 
основные : 
* объединение 
* разность 
* проекция 
* выбор 
* декартово произведение . 
вспомогательные :
* пересечение 
* соединение 
* слияние
* деление
 вспомогательные выражаются через основные и служат для краткости записи.

